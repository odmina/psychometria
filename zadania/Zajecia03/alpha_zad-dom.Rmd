---
title: "Alfa Cronbacha - zadanie domowe"
output: html
---

```{r}
#install.packages("tidyverse")
#jeżeli komórka zwraca błąd, to znaczy, że nie masz paczki tidyverse
#odkomentuj odpowiednią linijkę (usuń krzyżyki)
library(tidyverse)
```
W tym notatniku policzycie alfę Cronbacha dla skali narcyzmu wchodzącej w skład kwestionariusza "Krótka ciemna triada".

# Import danych

Poniższa komórka zaimportuje zbiór danych ze strony [openpsychometrics.org](https://openpsychometrics.org/_rawdata/). Nie zmieniaj kodu.

```{r}
temp <- tempfile()
download.file("http://openpsychometrics.org/_rawdata/SD3.zip",temp)
dane <- read_tsv(unzip(temp, files="SD3/data.csv"))
codebook <- unzip(temp, files="SD3/codebook.txt")
unlink(temp)
```

# Czyszczenie danych

Dane, które ściągnęliśmy, to wyniki w kwestionariuszu mierzącym "mroczną ciemną triadę", czyli makiawelizm, narcyzm i psychopatię. Chcemy zająć się analizą jedynie wyników w podskali narcyzmu. W związku z tym z całego zbioru wybierzemy tylko kolumny zawierające wyniki w tej skali.

```{r}
dane_narcyzm <- dane %>%
  select(starts_with("N"))
```

Żeby przystąpić do czyszczenia, musimy wiedzieć, co mamy w zbiorze. Poniższa komórka otworzy plik codebook.txt w domyślnym programie. 

```{r}
system2("open", codebook)
```

W coodebooku widzimy, jakie pytania zostały zadane i na jakiej skali udzielane były odpowiedzi. Niezależnie od pytania, każda wartość inna niż 1,2,3,4,5 będzie nieprawidłowa (spoza skali) i powinna być traktowana jako brak danych. Jeżeli zależy nam na tym, by nie utracić badanego, można takie wartości zastąpić średnią w skali. W naszym przypadku bardziej zasadne będzie jednak odfiltrowanie obserwacji z brakami. Poniższy kod pozostawi tylko obserwacje, dla których odpowiedzi we wszystkich pytaniach są liczbami całkowitymi od 1 do 5 i wyświetli informację pozwalającą stwierdzić, czy operacja się udała.

```{r}
dane_narcyzm <- dane_narcyzm %>%
  filter_all(all_vars(. %in% c(1,2,3,4,5)))
pytania <- c("N1", "N2", "N3", "N4", "N5", "N6", "N7", "N8", "N9")
for(i in seq_len(length(pytania))) {
  print(paste0(pytania[i], " min: ", min(dane_narcyzm[pytania[i]]), "   max: ", max(dane_narcyzm[pytania[i]])))
}
```
W codebooku zauważycie, że nie we wszystkich pytaniach odpowiedź 5 świadczy o wysokim poziomie narcyzmu. Pytania te wymagają odwrócenia. Zrobimy to przy pomocy funkcji, którą sami napiszemy. 

```{r}
odwroc <- function(pytanie, min=1, max=5){
  #min - minimum skali
  #max - maximum skali
  odwrocone <- max + min - pytanie
}
```

Proponuję, byście nie wyrzucali oryginalnych zmiennych, tylko stworzyli nowe, z odwróconymi odpowiedziami. Łatwiej w ten sposób uniknąć pomyłki. Musimy odwrócić pozycje 2, 6 i 8. Stworzymy również wektor identyfikujący pytania gotowe do analizy.

```{r}
dane_narcyzm$N2_r <- odwroc(dane_narcyzm$N2)
dane_narcyzm$N6_r <- odwroc(dane_narcyzm$N6)
dane_narcyzm$N8_r <- odwroc(dane_narcyzm$N8)
pytania_alfa <- c("N1", "N2_r", "N3", "N4", "N5", "N6_r", "N7", "N8_r", "N9")
```

# Liczymy alfę

## Paczka psych

Żeby policzyć alfę, musimy załadować paczkę "psych". Jeżeli jeszcze nigdy z niej nie korzystałaś/eś, usuń # w pierwszej linijce.

```{r}
#instal.packages("psych")
library(psych)
```

## Liczymy alfę

Teraz możesz wykorzystać funkcję alpha i zapisać jej wynik w zmiennej alfunia. Do dzieła! Skorzystaj z funkcji alpha z załadowanej właśnie paczki psych. Pamiętaj, żeby wskazać, gdzie w zbiorze znajdują się pytania testu. Skorzystaj w tym celu z utworzonego wcześniej wektora pytania_alfa. 

```{r}
alfunia <- psych::alpha(dane_narcyzm[pytania_alfa])
alfunia
```

## Radzimy sobie z koszmarnym outputem

Nie wiem jak Wy, ale ja nie znoszę surowego outputu funkcji alpha :) wyświetlcie najpierw samą surową alfę z zapisanego outputu.

```{r}
...$total$raw_alpha
```

Sprawdźcie, co dzieje się z alfą, kiedy usuniemy ze skali poszczególne itemy. Wyświetlona tabela będzie zawierała informacje na temat charakterystyki skali po usunięciu itemu wyszczególnionego w pierwszej kolumnie. Interesująca Was informacja znajduje się w kolumnie raw_alpha. Jak świadczy to o itemach skali?

```{r}
alfunia$alpha.drop
```

Zobaczcie, jaka jest średnia korelacja między itemami.

```{r}
...$total$average_r
```

Sprawdźcie, jakie są korelacje poszczególnych itemów z ogólnym wynikiem (kolumna raw.r) oraz z ogólnym wynikiem bez tego itemu (r.drop).

```{r}
...$item.stats
```


## Pytanie

**Zapisz poniżej odpowiedź na pytanie. Czy któryś z itemów skali jest wart usunięcia? Dlaczego tak uważasz?**

# Eksperymentujemy z alfą

Co się stanie, gdy dodamy bezsensowne pytanie?

Wyobraźmy sobie, że do naszego testu samooceny dodaliśmy pytanie o to, czy ktoś lubi jeździć samochodem. Nie zmieniaj kodu poniżej

```{r}
set.seed(40)
dane_narcyzm$auto <- round(rnorm(nrow(dane_narcyzm), 3, 1))

#w tej linijce wskazujemy pytania naszego nowego testu o narcyzmie i jeżdżeniu autem
wszystkie_auto <-c(pytania_alfa, "auto")
#a w tej sumę wyników z autem
dane_narcyzm$total_auto <- apply(dane_narcyzm[ , wszystkie_auto], 1, sum)
```

Zobaczmy, jak to, czy ktoś lubi jeździć samochodem koreluje z wynikiem naszego oryginalnego testu:

```{r}
#poniższa linijka policzy wynik oryginalnej skali (bez auta)
dane_narcyzm$total <- apply(dane_narcyzm[ , pytania_alfa], 1, sum)

cor(dane_narcyzm$total, dane_narcyzm$auto)
```

Zobaczmy, jak wygląda odchylenie standardowe wyniku testu bez zmiennej auto i ze zmienną auto. 

```{r}
#bez auta
sd(dane_narcyzm$total)

#z autem
sd(dane_narcyzm$total_auto)
```

Policz, jaka jest korelacja zmiennej auto z wybranym pytaniem testu. 

```{r}
cor(..., ...)
```

Policz alfę dla testu z dodanym pytaniem o auto

```{r}
psych::alpha(...)
```


Zapisz poniżej odpowiedź na pytanie: dlaczego alfa Cronbaha skali mierzącej narcyzm spadła po dodaniu pytania o jazdę  samochodem?